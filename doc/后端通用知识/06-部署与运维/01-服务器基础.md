# 服务器基础

## 1. 服务器概述

服务器是一种专门为其他计算机或设备提供服务的计算机，具有高性能、高可靠性、高可用性和高扩展性等特点。在Web应用架构中，服务器负责处理客户端请求、存储数据、运行应用程序等核心功能。

### 1.1 服务器的作用

- **处理客户端请求**：接收和响应客户端的HTTP/HTTPS请求
- **存储数据**：存储应用程序数据、用户数据和配置信息
- **运行应用程序**：运行后端应用程序、数据库和其他服务
- **提供网络服务**：提供DNS、FTP、SMTP等网络服务
- **管理资源**：管理服务器的CPU、内存、磁盘和网络资源

### 1.2 服务器的类型

#### 1.2.1 按物理形态分类

- **物理服务器**：独立的物理设备，具有自己的CPU、内存、磁盘和网络接口
- **虚拟机（VM）**：在物理服务器上通过虚拟化技术创建的虚拟计算机
- **容器**：轻量级的虚拟化技术，共享宿主操作系统内核
- **云服务器**：由云服务提供商提供的虚拟服务器，如EC2（AWS）、ECS（阿里云）、CVM（腾讯云）

#### 1.2.2 按功能分类

- **Web服务器**：处理HTTP/HTTPS请求，如Nginx、Apache
- **应用服务器**：运行后端应用程序，如Tomcat、Node.js
- **数据库服务器**：存储和管理数据，如MySQL、PostgreSQL、MongoDB
- **缓存服务器**：缓存频繁访问的数据，如Redis、Memcached
- **负载均衡服务器**：分发网络流量，如Nginx、HAProxy
- **文件服务器**：存储和共享文件，如FTP服务器、NFS服务器

### 1.3 服务器的主要组件

- **CPU**：处理计算任务，决定服务器的计算能力
- **内存（RAM）**：临时存储数据，影响服务器的运行速度
- **磁盘**：永久存储数据，包括系统文件、应用程序和数据
- **网络接口**：连接到网络，处理网络通信
- **电源**：为服务器提供电力，通常有冗余电源
- **散热系统**：保持服务器温度在正常范围内

## 2. 操作系统选择

服务器操作系统是服务器的核心软件，负责管理硬件资源、运行应用程序和提供服务。

### 2.1 常见的服务器操作系统

#### 2.1.1 Linux

Linux是最常用的服务器操作系统，具有开源、稳定、安全、高效等特点。

**优点**：
- 开源免费
- 稳定性高，适合长时间运行
- 安全性好，漏洞修复快
- 资源占用低
- 支持多种硬件平台
- 丰富的软件生态

**常见的Linux发行版**：

- **Ubuntu**：最受欢迎的Linux发行版之一，更新频繁，社区活跃
- **CentOS**：基于RedHat Enterprise Linux（RHEL），稳定可靠，适合服务器环境
- **Debian**：以稳定性和安全性著称，软件包丰富
- **RedHat Enterprise Linux（RHEL）**：商业Linux发行版，提供专业支持
- **SUSE Linux Enterprise Server（SLES）**：商业Linux发行版，适合企业级应用

#### 2.1.2 Windows Server

Windows Server是微软推出的服务器操作系统，适合运行.NET应用和Microsoft服务。

**优点**：
- 图形界面友好，易于管理
- 对.NET应用支持良好
- 集成Microsoft服务，如Active Directory、Exchange
- 提供专业支持

**缺点**：
- 收费
- 资源占用高
- 安全性相对较差
- 开源软件支持有限

### 2.2 操作系统选择考虑因素

- **应用需求**：根据应用程序的要求选择合适的操作系统
- **成本**：考虑操作系统的 licensing 成本
- **技术栈**：根据开发团队的技术栈选择
- **安全性**：考虑操作系统的安全特性和漏洞修复速度
- **稳定性**：考虑操作系统的稳定性和可靠性
- **支持和维护**：考虑是否需要专业支持
- **生态系统**：考虑操作系统的软件生态和社区支持

## 3. 服务器硬件配置

### 3.1 CPU选择

CPU是服务器的核心组件，影响服务器的计算能力。

**考虑因素**：
- **核心数**：多核心CPU适合并行处理，提高服务器的并发处理能力
- **主频**：主频越高，单线程性能越好
- **缓存**：更大的缓存可以提高CPU的运行效率
- **架构**：选择适合服务器应用的CPU架构，如x86-64
- **功耗**：考虑CPU的功耗和散热需求

**推荐**：
- 入门级服务器：4-8核心CPU
- 中端服务器：8-16核心CPU
- 高端服务器：16+核心CPU

### 3.2 内存配置

内存是服务器的重要资源，影响服务器的运行速度和并发处理能力。

**考虑因素**：
- **容量**：根据应用程序的内存需求配置足够的内存
- **类型**：选择适合服务器的内存类型，如DDR4、DDR5
- **频率**：内存频率越高，数据传输速度越快
- **ECC内存**：错误校验内存，提高数据可靠性，适合关键应用

**推荐**：
- 入门级服务器：8-16GB内存
- 中端服务器：16-64GB内存
- 高端服务器：64+GB内存

### 3.3 存储方案

存储是服务器的重要组成部分，用于存储系统文件、应用程序和数据。

#### 3.3.1 存储类型

- **HDD（硬盘驱动器）**：容量大，成本低，但读写速度慢
- **SSD（固态硬盘）**：读写速度快，功耗低，但容量小，成本高
- **NVMe SSD**：基于PCIe接口的高速存储，读写速度比SATA SSD快数倍

#### 3.3.2 RAID配置

RAID（独立磁盘冗余阵列）是一种将多个磁盘组合成一个逻辑磁盘的技术，可以提高存储的性能、可靠性或两者兼顾。

**常见的RAID级别**：

- **RAID 0**：条带化，提高性能，但没有冗余
- **RAID 1**：镜像，提供冗余，但成本高
- **RAID 5**：条带化+分布式奇偶校验，提供冗余和性能平衡
- **RAID 6**：条带化+双重奇偶校验，提供更高的冗余
- **RAID 10**：RAID 1+RAID 0，提供高性能和冗余

**推荐**：
- 对性能要求高：RAID 0、RAID 10
- 对可靠性要求高：RAID 1、RAID 5、RAID 6
- 兼顾性能和可靠性：RAID 5、RAID 6、RAID 10

### 3.4 网络配置

网络配置影响服务器的网络通信能力。

**考虑因素**：
- **网卡数量**：根据网络需求配置足够的网卡
- **网卡速度**：选择适合应用的网卡速度，如1Gbps、10Gbps
- **网络拓扑**：根据网络架构配置服务器网络
- **冗余网络**：配置多个网卡实现网络冗余

**推荐**：
- 入门级服务器：1-2个1Gbps网卡
- 中端服务器：2-4个1Gbps或10Gbps网卡
- 高端服务器：4+个10Gbps网卡

## 4. 服务器网络基础

### 4.1 IP地址和子网掩码

IP地址是服务器在网络中的唯一标识，子网掩码用于确定IP地址的网络部分和主机部分。

**IPv4地址格式**：
- 32位二进制数，通常表示为4个十进制数，如192.168.1.1
- 分为网络地址和主机地址两部分
- 子网掩码：如255.255.255.0（对应CIDR表示法/24）

**IPv6地址格式**：
- 128位二进制数，通常表示为8组十六进制数，如2001:0db8:85a3:0000:0000:8a2e:0370:7334
- 支持更多的地址空间，解决IPv4地址枯竭问题

### 4.2 网关和DNS

- **网关**：连接不同网络的设备，服务器通过网关访问外部网络
- **DNS（域名系统）**：将域名转换为IP地址，服务器需要配置DNS服务器以解析域名

### 4.3 端口和协议

- **端口**：用于区分不同的服务，范围为0-65535
- **协议**：规定数据传输的规则，如TCP、UDP、HTTP、HTTPS

**常见的服务端口**：
- SSH：22
- HTTP：80
- HTTPS：443
- MySQL：3306
- PostgreSQL：5432
- Redis：6379
- MongoDB：27017

### 4.4 防火墙基础

防火墙用于控制网络流量，保护服务器免受未经授权的访问。

**Linux防火墙**：
- **iptables**：传统的Linux防火墙工具
- **firewalld**：CentOS 7+和RHEL 7+的默认防火墙工具
- **ufw**：Ubuntu的默认防火墙工具，简化了iptables的配置

**基本防火墙规则**：
- 允许必要的服务端口访问
- 禁止不必要的端口访问
- 限制特定IP地址的访问

### 4.5 SSH远程登录

SSH（安全外壳协议）是一种用于远程登录服务器的安全协议，替代了不安全的Telnet协议。

**SSH登录命令**：
```bash
# 基本登录
ssh username@server_ip

# 指定端口
ssh -p port username@server_ip

# 使用密钥登录
ssh -i private_key username@server_ip
```

**SSH配置文件**：
- 服务器端：`/etc/ssh/sshd_config`
- 客户端：`~/.ssh/config`

## 5. 服务器安全配置

### 5.1 用户和权限管理

- **用户管理**：
  - 创建用户：`useradd username`
  - 设置密码：`passwd username`
  - 删除用户：`userdel username`
  - 添加用户到组：`usermod -aG groupname username`

- **权限管理**：
  - 更改文件所有者：`chown owner:group file`
  - 更改文件权限：`chmod permissions file`
  - 权限表示法：r（读，4）、w（写，2）、x（执行，1）
  - 示例：`chmod 755 file`（所有者：rwx，组：r-x，其他：r-x）

### 5.2 防火墙配置

#### 5.2.1 使用ufw（Ubuntu）

```bash
# 启用ufw
ufw enable

# 允许SSH访问
ufw allow ssh

# 允许HTTP和HTTPS访问
ufw allow http
ufw allow https

# 允许特定端口
ufw allow 3306/tcp

# 查看防火墙状态
ufw status
```

#### 5.2.2 使用firewalld（CentOS/RHEL）

```bash
# 启动firewalld
systemctl start firewalld

# 启用firewalld开机自启
systemctl enable firewalld

# 允许SSH访问
firewall-cmd --permanent --add-service=ssh

# 允许HTTP和HTTPS访问
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https

# 允许特定端口
firewall-cmd --permanent --add-port=3306/tcp

# 重新加载firewalld配置
firewall-cmd --reload

# 查看防火墙状态
firewall-cmd --list-all
```

### 5.3 SSH安全加固

- **禁用root远程登录**：
  ```bash
  # 修改/etc/ssh/sshd_config
  PermitRootLogin no
  ```

- **使用密钥认证，禁用密码认证**：
  ```bash
  # 修改/etc/ssh/sshd_config
  PasswordAuthentication no
  PubkeyAuthentication yes
  ```

- **更改SSH端口**：
  ```bash
  # 修改/etc/ssh/sshd_config
  Port 2222
  ```

- **限制SSH访问的IP地址**：
  ```bash
  # 使用ufw
  ufw allow from 192.168.1.0/24 to any port 22
  
  # 使用firewalld
  firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.1.0/24" port protocol="tcp" port="22" accept'
  firewall-cmd --reload
  ```

### 5.4 系统更新和补丁管理

定期更新系统和应用程序是保持服务器安全的重要措施。

**Ubuntu/Debian**：
```bash
# 更新软件包列表
apt-get update

# 更新所有软件包
apt-get upgrade

# 升级系统版本
apt-get dist-upgrade
```

**CentOS/RHEL**：
```bash
# 更新所有软件包
yum update

# 或者使用dnf（CentOS 8+）
dnf update
```

### 5.5 日志管理

日志是服务器运行状态的重要记录，用于监控和排查问题。

**常见的日志文件**：
- 系统日志：`/var/log/syslog`（Ubuntu）、`/var/log/messages`（CentOS）
- SSH日志：`/var/log/auth.log`（Ubuntu）、`/var/log/secure`（CentOS）
- Web服务器日志：`/var/log/nginx/`、`/var/log/apache2/`
- 应用程序日志：根据应用程序的配置而定

**日志管理工具**：
- **rsyslog**：Linux系统默认的日志管理工具
- **logrotate**：自动管理日志文件，防止日志文件过大
- **ELK Stack**：Elasticsearch、Logstash、Kibana，用于日志分析和可视化

## 6. Linux常用命令

### 6.1 文件和目录管理

- **列出文件和目录**：`ls`、`ls -la`
- **切换目录**：`cd directory`
- **创建目录**：`mkdir directory`、`mkdir -p path/to/directory`
- **删除文件**：`rm file`、`rm -f file`（强制删除）
- **删除目录**：`rmdir directory`、`rm -rf directory`（递归删除）
- **复制文件**：`cp source destination`
- **移动文件**：`mv source destination`
- **查看文件内容**：`cat file`、`less file`、`head file`、`tail file`
- **查找文件**：`find path -name "pattern"`
- **查找内容**：`grep "pattern" file`、`grep -r "pattern" directory`

### 6.2 进程管理

- **查看进程**：`ps aux`、`top`、`htop`
- **杀死进程**：`kill pid`、`kill -9 pid`（强制杀死）
- **查看端口占用**：`lsof -i :port`、`netstat -tuln`、`ss -tuln`
- **后台运行进程**：`command &`
- **查看后台进程**：`jobs`
- **将后台进程转为前台**：`fg job_id`

### 6.3 系统监控

- **查看系统负载**：`uptime`、`top`
- **查看CPU信息**：`lscpu`、`cat /proc/cpuinfo`
- **查看内存信息**：`free -h`、`cat /proc/meminfo`
- **查看磁盘使用情况**：`df -h`
- **查看磁盘I/O**：`iostat`、`iotop`
- **查看网络状态**：`netstat -tuln`、`ss -tuln`、`iftop`

### 6.4 网络管理

- **查看IP地址**：`ifconfig`、`ip addr`
- **测试网络连接**：`ping host`
- **测试端口连通性**：`telnet host port`、`nc -zv host port`
- **查看路由表**：`route`、`ip route`
- **DNS解析测试**：`nslookup domain`、`dig domain`

### 6.5 磁盘管理

- **查看磁盘分区**：`fdisk -l`、`lsblk`
- **格式化磁盘**：`mkfs.ext4 /dev/sdX`、`mkfs.xfs /dev/sdX`
- **挂载磁盘**：`mount /dev/sdX /mnt`
- **卸载磁盘**：`umount /mnt`
- **设置开机自动挂载**：编辑`/etc/fstab`文件

## 7. 服务器部署基础

### 7.1 环境准备

- **更新系统**：确保系统和软件包是最新的
- **安装必要的依赖**：根据应用程序的要求安装依赖包
- **配置防火墙**：开放必要的端口
- **创建专用用户**：为应用程序创建专用用户，避免使用root用户

### 7.2 软件安装和配置

- **使用包管理器安装软件**：`apt-get install package`（Ubuntu）、`yum install package`（CentOS）
- **从源码编译安装**：适用于需要特定版本的软件
- **使用Docker安装**：使用容器化方式安装软件，简化配置和管理

### 7.3 服务管理

- **启动服务**：`systemctl start service`
- **停止服务**：`systemctl stop service`
- **重启服务**：`systemctl restart service`
- **查看服务状态**：`systemctl status service`
- **设置开机自启**：`systemctl enable service`
- **禁用开机自启**：`systemctl disable service`

### 7.4 自动化部署基础

- **使用Shell脚本**：编写Shell脚本自动化部署流程
- **使用Ansible**：自动化配置管理工具，用于配置和部署服务器
- **使用Docker Compose**：定义和运行多容器Docker应用程序
- **使用CI/CD工具**：如Jenkins、GitLab CI、GitHub Actions，实现持续集成和持续部署

## 8. 服务器维护和监控

### 8.1 日常维护任务

- **备份数据**：定期备份重要数据
- **更新系统和软件**：定期更新系统和软件包
- **检查磁盘空间**：确保磁盘有足够的空间
- **检查系统负载**：监控CPU、内存和磁盘使用情况
- **检查日志**：查看系统和应用程序日志，排查问题
- **检查安全漏洞**：使用工具如`lynis`、`rkhunter`检查系统安全漏洞

### 8.2 系统监控工具

- **htop**：交互式进程查看器，显示CPU、内存、磁盘I/O等信息
- **iotop**：实时查看磁盘I/O使用情况
- **iftop**：实时查看网络流量
- **vmstat**：报告虚拟内存统计信息
- **mpstat**：报告CPU统计信息
- **nmon**：系统监控工具，提供CPU、内存、磁盘、网络等信息
- **Prometheus + Grafana**：开源监控系统，用于监控服务器和应用程序
- **Zabbix**：企业级监控解决方案，支持多种监控方式

### 8.3 常见问题排查

- **服务器无法访问**：检查网络连接、防火墙配置、服务状态
- **应用程序崩溃**：查看应用程序日志，检查错误信息
- **性能问题**：使用监控工具找出瓶颈，如CPU、内存、磁盘I/O或网络
- **磁盘空间不足**：清理不必要的文件，扩展磁盘空间
- **内存不足**：关闭不必要的服务，增加内存

## 9. 最佳实践

### 9.1 服务器配置最佳实践

- **使用专用用户**：为应用程序创建专用用户，避免使用root用户
- **最小化安装**：只安装必要的软件包，减少攻击面
- **分区合理**：合理划分磁盘分区，如/、/home、/var、/tmp
- **使用SSD**：优先使用SSD存储，提高服务器的运行速度
- **配置RAID**：根据需求配置合适的RAID级别，提高存储的性能或可靠性

### 9.2 安全最佳实践

- **定期更新系统和软件**：及时安装安全补丁
- **使用防火墙**：配置防火墙，只允许必要的端口访问
- **使用SSH密钥认证**：禁用密码认证，使用SSH密钥认证
- **限制SSH访问**：限制可以访问SSH的IP地址
- **禁用不必要的服务**：关闭不必要的服务，减少攻击面
- **使用SSL/TLS**：为所有服务配置SSL/TLS，加密数据传输
- **定期备份数据**：确保数据安全，防止数据丢失
- **监控系统日志**：及时发现异常行为

### 9.3 性能优化最佳实践

- **优化内核参数**：根据应用程序的需求优化Linux内核参数
- **调整文件描述符限制**：增加文件描述符限制，提高服务器的并发处理能力
- **优化网络配置**：调整网络参数，提高网络性能
- **使用缓存**：使用Redis、Memcached等缓存工具，减少数据库访问
- **优化数据库**：根据应用程序的需求优化数据库配置
- **使用CDN**：对于静态资源，使用CDN加速访问
- **负载均衡**：使用负载均衡器分发流量，提高系统的可用性和性能

### 9.4 自动化最佳实践

- **自动化部署**：使用CI/CD工具实现自动化部署，减少人为错误
- **自动化配置**：使用Ansible、Chef、Puppet等工具自动化配置管理
- **自动化监控**：使用监控工具自动监控系统和应用程序
- **自动化备份**：配置自动备份，确保数据安全
- **自动化恢复**：配置自动恢复机制，减少系统 downtime

## 10. 总结

服务器基础是后端开发和运维的重要组成部分，掌握服务器基础知识对于构建稳定、安全、高效的Web应用至关重要。

本章节介绍了服务器的类型、操作系统选择、硬件配置、网络基础、安全配置、常用命令、部署基础、维护和监控以及最佳实践等内容。

通过学习和实践这些知识，可以更好地理解服务器的工作原理，提高服务器的配置、管理和维护能力，为构建可靠的Web应用打下坚实的基础。